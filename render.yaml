services:
  - type: web
    name: tavernkeeper-web
    env: node
    plan: starter
    region: oregon
    buildCommand: npm install -g pnpm tsx && pnpm install --frozen-lockfile && RENDER_SERVICE_TYPE=web tsx scripts/validate-env.ts web && pnpm --filter @innkeeper/lib build && pnpm --filter @innkeeper/agents build && pnpm --filter @innkeeper/engine build && cd apps/web && pnpm exec next build --webpack
    startCommand: cd apps/web && pnpm start
    rootDir: ./
    healthCheckPath: /
    envVars:
      - key: NODE_ENV
        value: production
      - key: NODE_VERSION
        value: 20.18.0
      - key: NEXT_PUBLIC_USE_LOCALHOST
        value: "false"
      - key: RENDER_SERVICE_TYPE
        value: web
      - key: NEXT_PUBLIC_SUPABASE_PROJECT_URL
        sync: false
      - key: NEXT_PUBLIC_SUPABASE_API_KEY
        sync: false
      - key: REDIS_URL
        value: redis://default:LbE5xRYKm1OKw1xthVl70jQ3UFCAyOWi@redis-11468.c240.us-east-1-3.ec2.cloud.redislabs.com:11468

  - type: worker
    name: tavernkeeper-workers
    env: node
    plan: starter
    region: oregon
    buildCommand: npm install -g pnpm tsx && pnpm install --frozen-lockfile && RENDER_SERVICE_TYPE=worker tsx scripts/validate-env.ts worker && pnpm --filter @innkeeper/lib build && pnpm --filter @innkeeper/agents build && pnpm --filter @innkeeper/engine build
    startCommand: cd apps/web && pnpm start-worker
    rootDir: ./
    envVars:
      - key: NODE_ENV
        value: production
      - key: RENDER_SERVICE_TYPE
        value: worker
      - key: ENABLE_AUTO_HARVEST
        value: "true"
      - key: HARVEST_INTERVAL_HOURS
        value: "1"
      - key: KEEP_STAKING_PERCENT
        value: "90"
      - key: KEEP_DEPLOYER_PERCENT
        value: "10"
      - key: LP_STAKING_PERCENT
        value: "45"
      - key: WMON_BUYBACK_PERCENT
        value: "50"
      - key: WMON_DEPLOYER_PERCENT
        value: "50"
      - key: NEXT_PUBLIC_SUPABASE_PROJECT_URL
        sync: false
      - key: NEXT_PUBLIC_SUPABASE_API_KEY
        sync: false
      - key: REDIS_URL
        value: redis://default:LbE5xRYKm1OKw1xthVl70jQ3UFCAyOWi@redis-11468.c240.us-east-1-3.ec2.cloud.redislabs.com:11468
      - key: DEPLOYER_PRIVATE_KEY
        sync: false
      - key: NEXT_PUBLIC_MONAD_RPC_URL
        sync: false
      - key: NEXT_PUBLIC_MONAD_CHAIN_ID
        sync: false
      - key: NEXT_PUBLIC_USE_LOCALHOST
        sync: false

  # - type: web
  #   name: innkeeper-discord-bot
  #   env: node
  #   plan: starter
  #   region: oregon
  #   buildCommand: npm install -g pnpm tsx && pnpm install --frozen-lockfile && RENDER_SERVICE_TYPE=discord-bot tsx scripts/validate-env.ts discord-bot && pnpm --filter @innkeeper/discord-bot build
  #   startCommand: cd packages/discord-bot && node dist/index.js
  #   rootDir: ./
  #   envVars:
  #     - key: NODE_ENV
  #       value: production
  #     - key: RENDER_SERVICE_TYPE
  #       value: discord-bot
